<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Parsing Apple Workout Data | Rckwzrd’s Reference</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Parsing Apple Workout Data" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Apple provides easy access to personal workout data. The challenge is parsing the blob of data. Below is a protocol for extracting heart rate time series data. Tools: original idea python json module python xml api jq json processor Data retrieval Go to health app on iphone Tap profile icon and scroll to bottom Select “export all health data” option Push export.zip to cloud storage Retrieve and extract archive on local machine Note: Export process may take several minutes. Archive could be 10s of MB. unzip export.zip -d /path/to/dir Data format # file structure Explain contents of each file. Note which file has hear rate data. Convert xml to json with python import json import sys from xml.etree.ElementTree import iterparse for _, elem in iterparse(sys.argv[1]): if elem.tag == &quot;Record&quot;: if elem.attrib[&quot;type&quot;] == &quot;HKQuantityTypeIdentifierHeartRate&quot;: print(json.dumps(elem.attrib)) Explain that data is in xml. Need to use parse.py to find records with heart rate data. Stream json to csv with jq python3 parse.py data/export.xml | \ jq -r &#39;[.endDate, .type, .unit, .value] | @csv&#39; \ &gt; data/heart_rate.csv Explain that parse.py combined with jq will stream heart time series data into a csv file." />
<meta property="og:description" content="Apple provides easy access to personal workout data. The challenge is parsing the blob of data. Below is a protocol for extracting heart rate time series data. Tools: original idea python json module python xml api jq json processor Data retrieval Go to health app on iphone Tap profile icon and scroll to bottom Select “export all health data” option Push export.zip to cloud storage Retrieve and extract archive on local machine Note: Export process may take several minutes. Archive could be 10s of MB. unzip export.zip -d /path/to/dir Data format # file structure Explain contents of each file. Note which file has hear rate data. Convert xml to json with python import json import sys from xml.etree.ElementTree import iterparse for _, elem in iterparse(sys.argv[1]): if elem.tag == &quot;Record&quot;: if elem.attrib[&quot;type&quot;] == &quot;HKQuantityTypeIdentifierHeartRate&quot;: print(json.dumps(elem.attrib)) Explain that data is in xml. Need to use parse.py to find records with heart rate data. Stream json to csv with jq python3 parse.py data/export.xml | \ jq -r &#39;[.endDate, .type, .unit, .value] | @csv&#39; \ &gt; data/heart_rate.csv Explain that parse.py combined with jq will stream heart time series data into a csv file." />
<link rel="canonical" href="http://localhost:4000/2022/07/26/parsing-apple-workout-data.html" />
<meta property="og:url" content="http://localhost:4000/2022/07/26/parsing-apple-workout-data.html" />
<meta property="og:site_name" content="Rckwzrd’s Reference" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-26T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Parsing Apple Workout Data" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-26T00:00:00-05:00","datePublished":"2022-07-26T00:00:00-05:00","description":"Apple provides easy access to personal workout data. The challenge is parsing the blob of data. Below is a protocol for extracting heart rate time series data. Tools: original idea python json module python xml api jq json processor Data retrieval Go to health app on iphone Tap profile icon and scroll to bottom Select “export all health data” option Push export.zip to cloud storage Retrieve and extract archive on local machine Note: Export process may take several minutes. Archive could be 10s of MB. unzip export.zip -d /path/to/dir Data format # file structure Explain contents of each file. Note which file has hear rate data. Convert xml to json with python import json import sys from xml.etree.ElementTree import iterparse for _, elem in iterparse(sys.argv[1]): if elem.tag == &quot;Record&quot;: if elem.attrib[&quot;type&quot;] == &quot;HKQuantityTypeIdentifierHeartRate&quot;: print(json.dumps(elem.attrib)) Explain that data is in xml. Need to use parse.py to find records with heart rate data. Stream json to csv with jq python3 parse.py data/export.xml | \\ jq -r &#39;[.endDate, .type, .unit, .value] | @csv&#39; \\ &gt; data/heart_rate.csv Explain that parse.py combined with jq will stream heart time series data into a csv file.","headline":"Parsing Apple Workout Data","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/07/26/parsing-apple-workout-data.html"},"url":"http://localhost:4000/2022/07/26/parsing-apple-workout-data.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Rckwzrd&apos;s Reference" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Rckwzrd&#39;s Reference</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/cv.html">CV</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Parsing Apple Workout Data</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-07-26T00:00:00-05:00" itemprop="datePublished">Jul 26, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Apple provides easy access to personal workout data. The challenge is parsing the blob of data.</p>

<p><strong>Below is a protocol for extracting heart rate time series data.</strong></p>

<p>Tools:</p>

<ul>
  <li><a href="https://gist.github.com/hoffa/936db2bb85e134709cd263dd358ca309">original idea</a></li>
  <li><a href="https://docs.python.org/3/library/json.html?highlight=json#module-json">python json module</a></li>
  <li><a href="https://docs.python.org/3/library/xml.etree.elementtree.html">python xml api</a></li>
  <li><a href="https://stedolan.github.io/jq/">jq json processor</a></li>
</ul>

<h2 id="data-retrieval">Data retrieval</h2>

<ol>
  <li>Go to health app on iphone</li>
  <li>Tap profile icon and scroll to bottom</li>
  <li>Select “export all health data” option</li>
  <li>Push <code class="language-plaintext highlighter-rouge">export.zip</code> to cloud storage</li>
  <li>Retrieve and extract archive on local machine</li>
</ol>

<p>Note: Export process may take several minutes. Archive could be 10s of MB.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip export.zip -d /path/to/dir
</code></pre></div></div>

<h2 id="data-format">Data format</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># file structure
</code></pre></div></div>

<p>Explain contents of each file. Note which file has hear rate data.</p>

<h2 id="convert-xml-to-json-with-python">Convert xml to json with python</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import json
import sys
from xml.etree.ElementTree import iterparse

for _, elem in iterparse(sys.argv[1]):
    if elem.tag == "Record":
        if elem.attrib["type"] == "HKQuantityTypeIdentifierHeartRate":
            print(json.dumps(elem.attrib))
</code></pre></div></div>

<p>Explain that data is in xml. Need to use <code class="language-plaintext highlighter-rouge">parse.py</code> to find records with heart rate data.</p>

<h2 id="stream-json-to-csv-with-jq">Stream json to csv with jq</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 parse.py data/export.xml | \
jq -r '[.endDate, .type, .unit, .value] | @csv' \
&gt; data/heart_rate.csv
</code></pre></div></div>

<p>Explain that <code class="language-plaintext highlighter-rouge">parse.py</code> combined with <code class="language-plaintext highlighter-rouge">jq</code> will stream heart time series data into a csv file.</p>

  </div><a class="u-url" href="/2022/07/26/parsing-apple-workout-data.html" hidden></a>
</article>

      </div>
    </main><footer class="simple-footer">
    <!-- <p class="footer-color"> Matt Rhoads | <a href="mailto:mrhoads1@gmail.com">mrhoads1@gmail.com</a></p> -->
    <p></p>
</footer>
</body>

</html>
